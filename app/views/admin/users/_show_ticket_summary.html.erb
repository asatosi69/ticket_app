<div id='js-current_user_id' data-current_user_id='<%= current_user.id %>'></div>
チケット枚数の見方（凡例）
<p>
  <% types = Type.all.includes(:color) %>
  <% sample_sum_of_seat = Type.sum(:seat) %>
  <%= sample_sum_of_seat %><% types.each do |t| %><span style="color: <%= t.color.color_code %>;">(1)</span><% end %>
</p>
<% types.each do |t| %>
  <div style="color: <%= t.color.color_code%>;">
    この色は、<%= t.kind %>チケットの販売枚数を表します。1枚の<%= t.kind %>チケットは、席を<%= t.seat %>席分、消費します。
  </div>
<% end %>
<p>
黒色は、各種類のチケットの合計が何席分の売り上げなのかを示す。
</p>
上の例では、<%= sample_sum_of_seat %> 席埋まっており、内訳が「<% types.each do |t| %><span style="color: <%= t.color.color_code %>"><%= t.kind %>：1 </span><% end %>」であることをしめす
<table class='index_table' id='summary_table'>
  <th></th>
  <% Stage.all.each do |stage| %>
    <th><%= stage.performance %></th>
  <% end %>
  <th>集計</th>
  <tr id="summary_line">
    <th>座席</th>
      <% @stages.each do |stage| %>
        <td><%= stage.total %></td>
      <% end %>
      <td><%= @stages.pluck(:total).sum %></td>
  </tr>
  <tr>
    <th>販売済</th>
  </tr>
  <tr>
    <th>充足率</th>
  </tr>
</table>
<script>
  var current_user_id = $('#js-current_user_id').data('current_user_id');
  $.ajax({
    url:' /users/' + current_user_id + '/ticket_summary.json',
    type: 'GET',
    data:{
    }
  })
  // Ajaxリクエストが成功した時発動
  .done( (datas) => {
    // $('.result').html(data);
    console.log(datas);
    datas.forEach( (data) => {
      var row_id = 'table_row_' + data.user_id
      $("#summary_line").before($("<tr id='" + row_id + "'></tr>"));
      $('#' + row_id).append($("<td></td>").text(data.user_name));
      data.counts_by_stage.forEach( (val) => {
        var content = val.total_seats_count;
        val.counts_by_type.forEach( (count_by_type) => {
          content += '<span style="color: ' + count_by_type.color_code + '";>(' + count_by_type.count + ')</span>'
        });

        $('#' + row_id).append($("<td></td>").html(content));
      });
      $('#' + row_id).append($("<td></td>").text(data.total_counts.summary_total_seats));
    });
  })
</script>
